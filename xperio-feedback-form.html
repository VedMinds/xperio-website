<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xperio - Thank You for Exploring with Us!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f9f9f9;
            color: #444;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            animation: fadeInUp 0.8s forwards;
        }

        .logo-container {
            text-align: center;
            padding: 20px;
            background-color: white;
        }

        .logo-img {
            max-height: 80px;
            max-width: 100px;
        }

        .header {
            background-color: #222232;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 400;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.8;
            font-size: 16px;
        }

        .form-container {
            padding: 30px;
        }
        input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input[type="email"]:focus {
            border-color: #222232;
            outline: none;
            box-shadow: 0 0 0 2px rgba(34, 34, 50, 0.1);
        }

        .your-info-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        input[type="text"]::placeholder,
        input[type="email"]::placeholder {
            color: #aaa;
            font-size: 14px;
        }

        /* Optional: Add a nice transition effect on focus */
        input[type="text"],
        input[type="email"] {
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="email"]:focus {
            transform: translateY(-2px);
        }

        .section {
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .section-title {
            font-size: 20px;
            color: #222232;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #222232;
            display: inline-block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 500;
        }

        .required-label {
            margin-bottom: 1%;
        }

        .required-label::after {
            content: " *";
            color: #ff4444;
        }

        .optional-label::after {
            content: " (optional)";
            font-size: 0.85em;
            color: #888;
            font-weight: normal;
        }

        .rating-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .rating-option {
            display: flex;
            align-items: center;
        }

        input[type="radio"] {
            margin-right: 8px;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        textarea:focus {
            border-color: #222232;
            outline: none;
            box-shadow: 0 0 0 2px rgba(34, 34, 50, 0.1);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .checkbox-group {
            margin: 15px 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            width: 16px;
            height: 16px;
        }

        .checkboxes-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .file-upload {
            margin-top: 20px;
        }

        .file-upload-btn {
            display: inline-block;
            background-color: #f0f0f0;
            color: #444;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .file-upload-btn:hover {
            background-color: #ddd;
        }

        input[type="file"] {
            display: none;
        }

        .uploaded-files {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .uploaded-file {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .uploaded-file img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.8);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            color: #ff4444;
        }

        .submit-btn {
            display: inline-block;
            padding: 14px 32px;
            background-color: #222232;
            color: #fff;
            text-decoration: none;
            font-size: 16px;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border-radius: 30px;
            font-weight: 500;
            border: 2px solid #222232;
            cursor: pointer;
            margin-top: 20px;
        }

        .submit-btn:hover {
            background-color: #fff;
            color: #222232;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .order-id {
            font-size: 14px;
            color: #888;
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .thank-you {
            text-align: center;
            padding: 50px 20px;
            display: none;
        }

        .thank-you h2 {
            font-size: 28px;
            color: #222232;
            margin-bottom: 15px;
        }

        .thank-you p {
            font-size: 16px;
            margin-bottom: 30px;
        }

        .error-message {
            color: #ff4444;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .file-size-info {
            font-size: 14px;
            color: #888;
            margin-top: 5px;
        }

        .upload-progress {
            width: 100%;
            height: 5px;
            background-color: #eee;
            margin-top: 10px;
            border-radius: 5px;
            overflow: hidden;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background-color: #222232;
            width: 0%;
            transition: width 0.3s ease;
        }

        .upload-status {
            font-size: 14px;
            color: #888;
            margin-top: 5px;
            display: none;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .form-container {
                padding: 20px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .rating-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .form-container {
                padding: 15px;
            }

            .header h1 {
                font-size: 20px;
            }

            .section-title {
                font-size: 18px;
            }

            .submit-btn {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <img src="https://wsrv.nl/?url=https://xperio-images.s3.ap-south-1.amazonaws.com//xperio/unapproved/experience/1T7J6c9LHDKCNTX.png"
                alt="Xperio Logo" class="logo-img">
            <h2>Thank You for Exploring with Us!</h2>
            <p>We'd love to hear about your experience. Your feedback helps us enhance our immersive travel experiences!
            </p>
        </div>

        <div class="form-container">
            <div id="orderIdContainer" class="order-id">
                Order ID: <span id="orderIdDisplay"></span>
            </div>

            <form id="feedbackForm">
                <input type="hidden" id="orderId" name="orderId">
                <input type="hidden" id="experienceId" name="experienceId">
                <input type="hidden" id="userId" name="userId">

                <div class="section">
                    <h2 class="section-title">Your Information</h2>

                    <div class="form-group">
                        <label class="required-label" for="fullName">Full Name</label>
                        <input type="text" id="fullName" name="fullName" required placeholder="Enter your full name">
                    </div>

                    <div class="form-group">
                        <label class="required-label" for="email">Email Address</label>
                        <input type="email" id="email" name="email" required placeholder="Enter your email address">
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">Feedback</h2>

                    <div class="form-group">
                        <label class="required-label">1. How would you rate your overall experience?</label>
                        <div class="rating-options">
                            <div class="rating-option">
                                <input type="radio" id="rating-excellent" name="overall-rating" value="5" required>
                                <label for="rating-excellent">Excellent</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="rating-good" name="overall-rating" value="4">
                                <label for="rating-good">Good</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="rating-average" name="overall-rating" value="3">
                                <label for="rating-average">Average</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="rating-below" name="overall-rating" value="2">
                                <label for="rating-below">Below Expectations</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="rating-poor" name="overall-rating" value="1">
                                <label for="rating-poor">Very Poor</label>
                            </div>
                        </div>
                        <div class="error-message" id="overall-rating-error">Please select an option</div>
                    </div>

                    <div class="form-group">
                        <label class="optional-label" for="comment">Comment</label>
                        <textarea id="comment" name="comment"
                            placeholder="Please share your thoughts about the experience"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="required-label">2. Did you feel the experience was authentic and
                            immersive?</label>
                        <div class="rating-options">
                            <div class="rating-option">
                                <input type="radio" id="authentic-absolutely" name="authentic-immersive"
                                    value="Absolutely" required>
                                <label for="authentic-absolutely">Absolutely</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="authentic-somewhat" name="authentic-immersive"
                                    value="To some extent">
                                <label for="authentic-somewhat">To some extent</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="authentic-not" name="authentic-immersive" value="Not really">
                                <label for="authentic-not">Not really</label>
                            </div>
                        </div>
                        <div class="error-message" id="authentic-immersive-error">Please select an option</div>
                    </div>

                    <div class="form-group">
                        <label class="required-label">3. What part of the experience did you enjoy the most?</label>
                        <div class="checkboxes-container">
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-booking" name="enjoy-parts"
                                    value="Ease of enquiry and booking on xperio" class="required-checkbox">
                                <label for="enjoy-booking">Ease of enquiry and booking on xperio</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-immersion" name="enjoy-parts"
                                    value="Immersion in any (nature, culture, spiritual, adventure etc..)"
                                    class="required-checkbox">
                                <label for="enjoy-immersion">Immersion in any (nature, culture, spiritual, adventure
                                    etc..)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-culture" name="enjoy-parts"
                                    value="Culture, story telling, art etc" class="required-checkbox">
                                <label for="enjoy-culture">Culture, story telling, art etc</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-activities" name="enjoy-parts"
                                    value="Activities and story telling" class="required-checkbox">
                                <label for="enjoy-activities">Activities and story telling</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-interaction" name="enjoy-parts"
                                    value="Interaction with host and community" class="required-checkbox">
                                <label for="enjoy-interaction">Interaction with host and community</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-cuisine" name="enjoy-parts"
                                    value="Local cuisine and cooking" class="required-checkbox">
                                <label for="enjoy-cuisine">Local cuisine and cooking</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-location" name="enjoy-parts"
                                    value="Peaceful and offbeat location" class="required-checkbox">
                                <label for="enjoy-location">Peaceful and offbeat location</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-accommodation" name="enjoy-parts"
                                    value="Accommodation and hospitality" class="required-checkbox">
                                <label for="enjoy-accommodation">Accommodation and hospitality</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-bonding" name="enjoy-parts"
                                    value="Group bonding and shared moments" class="required-checkbox">
                                <label for="enjoy-bonding">Group bonding and shared moments</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enjoy-everything" name="enjoy-parts"
                                    value="Everything – the entire experience was memorable" class="required-checkbox">
                                <label for="enjoy-everything">Everything – the entire experience was memorable</label>
                            </div>
                        </div>
                        <div class="error-message" id="enjoy-parts-error">Please select at least one option</div>
                    </div>

                    <div class="form-group">
                        <label class="required-label">4. Were the facilities as expected and comfortable? (pickup, stay,
                            food & communication)</label>
                        <div class="rating-options">
                            <div class="rating-option">
                                <input type="radio" id="facilities-very" name="facilities" value="Yes, very comfortable"
                                    required>
                                <label for="facilities-very">Yes, very comfortable</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="facilities-okay" name="facilities" value="Mostly okay">
                                <label for="facilities-okay">Mostly okay</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="facilities-better" name="facilities" value="Could be better">
                                <label for="facilities-better">Could be better</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="facilities-not" name="facilities" value="Not comfortable">
                                <label for="facilities-not">Not comfortable</label>
                            </div>
                        </div>
                        <div class="error-message" id="facilities-error">Please select an option</div>
                    </div>

                    <div class="form-group">
                        <label class="optional-label" for="facilities-comment">Comment</label>
                        <textarea id="facilities-comment" name="facilities-comment"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="required-label">5. Did you face any challenges or issues during your
                            experience?</label>
                        <textarea id="challenges" name="challenges" required></textarea>
                        <div class="error-message" id="challenges-error">Please provide your response</div>
                    </div>

                    <div class="form-group">
                        <label class="required-label">6. Would you recommend this experience to others?</label>
                        <div class="rating-options">
                            <div class="rating-option">
                                <input type="radio" id="recommend-definitely" name="recommend" value="Definitely"
                                    required>
                                <label for="recommend-definitely">Definitely</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="recommend-maybe" name="recommend" value="Maybe">
                                <label for="recommend-maybe">Maybe</label>
                            </div>
                            <div class="rating-option">
                                <input type="radio" id="recommend-not" name="recommend" value="Not likely">
                                <label for="recommend-not">Not likely</label>
                            </div>
                        </div>
                        <div class="error-message" id="recommend-error">Please select an option</div>
                    </div>

                    <div class="form-group">
                        <label class="required-label">7. Any suggestions to improve this experience or your journey with
                            Xperio? (price, location accessibility, accommodation, host communication etc..)</label>
                        <div class="checkboxes-container">
                            <div class="checkbox-item">
                                <input type="checkbox" id="improve-price" name="suggestions"
                                    value="Lower the price for better affordability" class="required-checkbox">
                                <label for="improve-price">Lower the price for better affordability</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="improve-access" name="suggestions"
                                    value="Choose destinations that are more easily accessible"
                                    class="required-checkbox">
                                <label for="improve-access">Choose destinations that are more easily accessible</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="improve-comfort" name="suggestions"
                                    value="Improve stay and facility comfort" class="required-checkbox">
                                <label for="improve-comfort">Improve stay and facility comfort</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="improve-communication" name="suggestions"
                                    value="Enhance communication before or during the trip" class="required-checkbox">
                                <label for="improve-communication">Enhance communication before or during the
                                    trip</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="improve-itinerary" name="suggestions"
                                    value="Provide clearer itinerary or expectations before booking"
                                    class="required-checkbox">
                                <label for="improve-itinerary">Provide clearer itinerary or expectations before
                                    booking</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="improve-transport" name="suggestions"
                                    value="Improve local transportation arrangements" class="required-checkbox">
                                <label for="improve-transport">Improve local transportation arrangements</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="improve-discounts" name="suggestions"
                                    value="Offer group discounts or packages" class="required-checkbox">
                                <label for="improve-discounts">Offer group discounts or packages</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="improve-none" name="suggestions"
                                    value="Everything was good, no suggestions" class="required-checkbox">
                                <label for="improve-none">Everything was good, no suggestions</label>
                            </div>
                        </div>
                        <div class="error-message" id="suggestions-error">Please select at least one option</div>
                    </div>

                    <div class="form-group">
                        <label class="optional-label">8. Upload Images and videos you would like to share
                            publicly</label>
                        <div class="file-upload">
                            <label for="mediaUpload" class="file-upload-btn">
                                <i class="fa fa-upload"></i> Select Files
                            </label>
                            <input type="file" id="mediaUpload" multiple accept="image/*,video/*">
                        </div>
                        <div class="upload-progress" id="uploadProgress">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        <div class="upload-status" id="uploadStatus">Uploading files...</div>
                        <div class="uploaded-files" id="uploadedFiles"></div>
                        <div class="error-message" id="file-size-error">One or more files exceed the 25MB limit</div>
                        <div class="error-message" id="file-upload-error">Error uploading one or more files. Please try
                            again.</div>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Submit Feedback</button>
            </form>

            <div class="thank-you" id="thankYouMessage">
                <h2>Thank You!</h2>
                <p>We appreciate your feedback and look forward to creating more unforgettable experiences with you.</p>
                <button class="submit-btn" id="newFeedbackBtn">Share Another Experience</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');
            const experienceId = urlParams.get('experienceId');
            const userId = urlParams.get('userId');

            // Populate hidden inputs
            if (orderId) {
                document.getElementById('orderId').value = orderId;
                document.getElementById('orderIdDisplay').textContent = orderId;
            } else {
                document.getElementById('orderIdContainer').classList.add('hidden');
            }

            if (experienceId) {
                document.getElementById('experienceId').value = experienceId;
            }

            if (userId) {
                document.getElementById('userId').value = userId;
            }

            const fullName = document.getElementById('fullName');

            const email = document.getElementById('email');
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            // Handle file uploads
            const fileInput = document.getElementById('mediaUpload');
            const uploadedFiles = document.getElementById('uploadedFiles');
            const fileSizeError = document.getElementById('file-size-error');
            const fileUploadError = document.getElementById('file-upload-error');
            const uploadProgress = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const uploadStatus = document.getElementById('uploadStatus');
            const MAX_FILE_SIZE = 25 * 1024 * 1024; // 25MB in bytes
            const mediaUrls = []; // To store the URLs returned from the API

            // Function to upload a file and return a promise
            async function uploadFile(file) {
                const formData = new FormData();
                formData.append('filePartFlux', file);

                try {
                    const response = await fetch('https://qa-api.xperio.travel/media/upload?entityType=EXPERIENCE', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error('Upload failed with status: ' + response.status);
                    }

                    // Parse the JSON response
                    const data = await response.json();

                    let url;
                    if (file.type.startsWith('image/')) {
                        url = data?.imageUrls?.[0];
                    } else if (file.type.startsWith('video/')) {
                        url = data?.videoUrls?.[0];
                    }

                    if (!url) {
                        throw new Error('No URL returned from server');
                    }

                    return url;
                } catch (error) {
                    console.error("Upload error:", error);
                    throw error;
                }
            }

            fileInput.addEventListener('change', async function () {
                const files = this.files;
                let hasOversizedFile = false;
                let filesToUpload = [];

                // Reset errors
                fileSizeError.style.display = 'none';
                fileUploadError.style.display = 'none';

                // Check file sizes
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];

                    if (file.size > MAX_FILE_SIZE) {
                        hasOversizedFile = true;
                        continue;
                    }

                    if (file.type.startsWith('image/') || file.type.startsWith('video/')) {
                        filesToUpload.push(file);
                    }
                }

                if (hasOversizedFile) {
                    fileSizeError.style.display = 'block';
                }

                if (filesToUpload.length === 0) {
                    return;
                }

                // Show upload progress
                uploadProgress.style.display = 'block';
                uploadStatus.style.display = 'block';
                progressBar.style.width = '0%';

                // Upload files one by one
                for (let i = 0; i < filesToUpload.length; i++) {
                    const file = filesToUpload[i];
                    const percentComplete = Math.round((i / filesToUpload.length) * 100);
                    progressBar.style.width = percentComplete + '%';
                    uploadStatus.textContent = `Uploading ${i + 1} of ${filesToUpload.length}`;

                    try {
                        // Create thumbnail preview while uploading
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const fileContainer = document.createElement('div');
                            fileContainer.className = 'uploaded-file';
                            fileContainer.dataset.index = i;

                            const img = document.createElement('img');
                            img.src = e.target.result;

                            fileContainer.appendChild(img);
                            uploadedFiles.appendChild(fileContainer);
                        };
                        reader.readAsDataURL(file);

                        // Upload to API
                        const url = await uploadFile(file);

                        // Add URL to mediaUrls array - THIS WAS MISSING
                        mediaUrls.push(url);

                        // Add remove button after successful upload
                        const fileContainer = uploadedFiles.querySelector(`[data-index="${i}"]`);
                        if (fileContainer) {
                            const removeBtn = document.createElement('div');
                            removeBtn.className = 'remove-file';
                            removeBtn.innerHTML = '✕';
                            removeBtn.dataset.url = url;
                            removeBtn.addEventListener('click', function () {
                                const urlToRemove = this.dataset.url;
                                const index = mediaUrls.indexOf(urlToRemove);
                                if (index > -1) {
                                    mediaUrls.splice(index, 1);
                                }
                                fileContainer.remove();
                            });
                            fileContainer.appendChild(removeBtn);
                        }
                    } catch (error) {
                        fileUploadError.style.display = 'block';
                    }
                }

                // Complete the progress
                progressBar.style.width = '100%';
                uploadStatus.textContent = `Uploaded ${mediaUrls.length} files successfully`;

                // Hide progress after a delay
                setTimeout(() => {
                    uploadProgress.style.display = 'none';
                    uploadStatus.style.display = 'none';
                }, 3000);
            });

            // Form validation
            const feedbackForm = document.getElementById('feedbackForm');

            function validateForm() {
                let isValid = true;

                // Validate radio buttons
                const radioGroups = ['overall-rating', 'authentic-immersive', 'facilities', 'recommend'];
                radioGroups.forEach(group => {
                    const checkedRadio = document.querySelector(`input[name="${group}"]:checked`);
                    const errorElement = document.getElementById(`${group}-error`);

                    if (!checkedRadio) {
                        errorElement.style.display = 'block';
                        isValid = false;
                    } else {
                        errorElement.style.display = 'none';
                    }
                });

                // Validate checkbox groups
                const checkboxGroups = ['enjoy-parts', 'suggestions'];
                checkboxGroups.forEach(group => {
                    const checkedBoxes = document.querySelectorAll(`input[name="${group}"]:checked`);
                    const errorElement = document.getElementById(`${group}-error`);

                    if (checkedBoxes.length === 0) {
                        errorElement.style.display = 'block';
                        isValid = false;
                    } else {
                        errorElement.style.display = 'none';
                    }
                });

                // Validate challenges textarea
                const challenges = document.getElementById('challenges');
                const challengesError = document.getElementById('challenges-error');

                if (!challenges.value.trim()) {
                    challengesError.style.display = 'block';
                    isValid = false;
                } else {
                    challengesError.style.display = 'none';
                }

                return isValid;
            }

            // Helper function to get selected values from checkbox groups
            function getSelectedCheckboxValues(name) {
                const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
                return Array.from(checkboxes).map(cb => cb.value);
            }

            // Form submission
            feedbackForm.addEventListener('submit', function (e) {
                e.preventDefault();

                if (!validateForm()) {
                    const firstError = document.querySelector('.error-message[style="display: block"]');
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    return;
                }

                // Check for oversized files
                if (document.getElementById('file-size-error').style.display === 'block') {
                    document.getElementById('file-size-error').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }

                // For debugging - log the mediaUrls array before submission
                console.log("Media URLs being submitted:", mediaUrls);

                // Map form data to API request format
                const apiRequestData = {
                    orderId: document.getElementById('orderId').value,
                    experienceId: document.getElementById('experienceId').value,
                    guestName: document.getElementById('fullName').value,
                    guestEmailId: document.getElementById('email').value,
                    userId: document.getElementById('userId').value,
                    ratingCount: parseInt(document.querySelector('input[name="overall-rating"]:checked').value),
                    comment: document.getElementById('comment').value,
                    hostRatingCount: 5, // Default value as this is not in the form
                    hostComment: "", // Default value as this is not in the form
                    wasExperienceAuthenticAndImmersive: document.querySelector('input[name="authentic-immersive"]:checked').value,
                    mostEnjoyablePart: getSelectedCheckboxValues('enjoy-parts'),
                    wereComfortableFacilitiesProvided: document.querySelector('input[name="facilities"]:checked').value,
                    comfortableFacilitiesComment: document.getElementById('facilities-comment').value,
                    challengesDuringExperience: document.getElementById('challenges').value,
                    wouldRecommend: document.querySelector('input[name="recommend"]:checked').value,
                    xperioImprovementSuggestions: getSelectedCheckboxValues('suggestions'),
                    media: mediaUrls // Use the mediaUrls array directly
                };

                // API endpoint
                const apiEndpoint = `https://qa-api.xperio.travel/app/experience-review/public/add-review?orderId=${orderId}&experienceId=${experienceId}&userId=${userId}`;

                fetch(apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(apiRequestData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        feedbackForm.style.display = 'none';
                        document.getElementById('thankYouMessage').style.display = 'block';
                    })
                    .catch(error => {
                        alert('There was an error submitting your feedback. Please try again.');
                        console.error("Form submission error:", error);
                    });
            });

            document.getElementById('newFeedbackBtn').addEventListener('click', function () {
                feedbackForm.reset();

                // Clear uploaded files
                uploadedFiles.innerHTML = '';
                mediaUrls.length = 0; // Clear the array

                // Hide thank you message and show form
                document.getElementById('thankYouMessage').style.display = 'none';
                feedbackForm.style.display = 'block';

                // Reset all error messages
                document.querySelectorAll('.error-message').forEach(elem => {
                    elem.style.display = 'none';
                });
            });
        });
    </script>
</body>

</html>